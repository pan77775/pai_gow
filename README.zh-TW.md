# 天九牌實機核心演算法與模擬器 (Pai Gow GTO & House Way Engine)

[English Version](README.md)

這是一個專注於**天九牌（Pai Gow）賽局理論最佳解 (GTO) 與 House Way 策略解析**的核心運算引擎與模擬器。

> **⚠️ 重要聲明 (Disclaimer)**
> 本專案實作的天九牌算法，是基於**無抽水、無莊家優勢的公平零和遊戲 (Zero-Sum Game)** 假設所建立的純數學與賽局理論模型。
> 真實賭場中存在 5% 的贏家抽水 (Commission) 且由莊家贏得所有平手 (Copy Hands)。本演算法及算出的 EV 值**絕對不適用於真實賭場環境**，請勿將其用於任何實際博弈行為。

## 專案重點：核心判牌與策略引擎

本專案的核心價值在於深入且精確的純 JavaScript 演算法實作，前端僅做為視覺化驗證與測試操作介面。

- **完整的判牌與階級引擎**：
  內建所有 32 張傳統天九牌的特殊牌型判定邏輯。能精準比對至尊、王、槓，乃至於常規對子、單牌點數比大小與複雜的花色階級規則。
- **正統 House Way 演算法實作**：
  實作了傳統 House Way 防守策略規則。能根據手牌的極端情況自動判斷是否要拆牌 (Split) 或守牌，並總是得出最符合作莊的防守排列。
- **GTO 混合策略矩陣解析器 (GT Matrix Solver)**：
  跳脫單一最佳解的框架。引擎會模擬所有可能的對手剩餘手牌空間（最高達 2 萬多種組合）建立報酬矩陣，並算出能最大化勝率的「最佳化混合策略比例」(例如：60% 採用出法A、40% 採用出法B)。
- **極致的演算效能與快取機制**：
  大量應用 32-bit Bitmask 加速運算。利用 Caching Map 與預先演算 (Pre-calculation) 技術，能夠在毫秒內瞬間遍歷與處理高達 35,960 種預算排列組合，讓龐大的機率統計與最佳步演算在網頁環境下即時完成。

## 視覺化前端

- 提供流暢順手的視覺化測試牌桌，以 React + Tailwind CSS 構建。
- 精準還原骨牌點數分佈，並實時渲染計算結果與矩陣解析報表，方便開發者觀測引擎輸出的各項機率與策略指標。

## 如何啟動測試環境

1. **安裝環境依賴:**
   ```bash
   npm install
   ```
2. **啟動本地開發伺服器:**
   ```bash
   npm run dev
   ```

## 獨立運算腳本 (Scripts)

在 `scripts/` 目錄中，提供了脫離前端 UI、純 Node.js 環境下的核心壓力測試與掛機運算腳本：
- `testPerf.js`: 用來執行大量組合產生的效能基準測試。
- `testHouseWay.js`: 用來獨立驗證與除錯特定 House Way 牌型組合的判斷是否正確。
- `simulateGTO.cjs`: 跑上萬局的 GTO 勝率與期望值掛機模擬腳本。
- `exportTable.js`: 負責將龐大的牌譜快取表匯出成外部資料結構。
